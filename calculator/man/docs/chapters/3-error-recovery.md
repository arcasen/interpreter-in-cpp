## Panic Mode 错误恢复 （ Panic Mode Error Recovery ）

在编译原理（Compiler Design）中，Panic Mode（恐慌模式）是一种常见的语法错误恢复策略，主要用于语法分析（Parsing）阶段。 Panic Mode 是处理编译时语法错误的最简单且最流行的方法之一，当解析器遇到无法处理的无效输入时，通过“恐慌”方式快速恢复，继续分析剩余代码，从而避免整个编译过程崩溃。基本思想是一旦检测到错误，语法分析器就“恐慌”起来，认为当前所处的状态（比如正在分析一个结构）已经不可靠了。于是丢弃后续的输入符号（Token），直到找到一个同步点（synchronizing token），然后从该点重新开始分析。

现在要分析典型的四则运算表达式文法（递归下降风格）的同步点（synchronizing token）。
通常，同步点会选择在一个非终结符的 FIRST 集或一个规则结束后的 FOLLOW 集中的 Token。  

### 非终结符的 FIRST 集合 和 FOLLOW 集合

四则运算表达式文法的非终结符和终结符：

- 非终结符：`expr`, `term`, `factor`。  
- 终结符：`+`, `-`, `*`, `/`, `(`, `)`, `digit`，以及输入结束 `$`。（ `integer` 可视为终结符 `digit` 或直接处理为数字令牌）

FIRST 集合：

- FIRST(factor) = { `(`, `digit` }
- FIRST(term) = { `(`, `digit` }
- FIRST(expr) = { `(`, `digit` }

FOLLOW 集合：

- FOLLOW(expr)   = { `)`, `$` }
- FOLLOW(term)   = { `+`, `-`, `)`, `$` }
- FOLLOW(factor) = { `*`, `/`, `+`, `-`, `)`, `$` }

### 同步点的选择

在递归下降分析中：
- 进入某个非终结符的函数时，如果当前 Token 不在它的 FIRST 集里，可以报错，并跳过 Token 直到遇到 FIRST 或 FOLLOW 中的 Token。  
- FOLLOW 集里的 Token 可作为从该非终结符退出的同步点。  

在 Panic Mode 中，对于每个非终结符，使用其 FOLLOW 集中的终结符作为同步点（丢弃 Token 直到遇到这些）。这能确保恢复到“预期结束”位置，避免过度丢弃有效代码。

| 非终结符   | FOLLOW 集（同步点） | 解释                                         |
| --------- | -------------------- | ---------------------------------------- |
| **expr**   | {`)`, `$`}                     | 表达式结束于右括号或文件末尾。   |
| **term**   | {`+`, `-`, `)`, `$`}           | 项结束于加减运算符、右括号或末尾。 |
| **factor** | {`*`, `/`, `+`, `-`, `)`, `$`} | 因子结束于乘除/加减运算符、右括号或末尾。|

: 同步点的选择 {.striped}

同步点不一定只能选 FOLLOW 集。FOLLOW 集是推荐和最优的选择，但实际实现中可以灵活调整，甚至使用固定或自定义的同步点集。
